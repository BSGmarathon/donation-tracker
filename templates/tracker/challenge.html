{% extends prepend|add:"tracker/index.html" %}
{% load donation_tags %}
{% load i18n %}

{% block title %}{% trans "Challenge Detail" %} -- {{ dbtitle|title }}{% endblock %}

{% block content %}
	<div class="title">
		<b>
			{% trans "Game" %}:
		</b>
		{{ challenge.speedrun|title }} 
		<b>
			{% trans "Challenge" %}:
		</b>
		{{ challenge.name|title }}
		<b>
			{% trans "Total" %}:
		</b>
		{{ agg.amount|money }}
	</div>
	<table>
	{% if challenge.description|length > 0 %}
		<tr class="header">
			<td align="center" colspan="4">
				<b>
					{% trans "Description" %}
				</b>
			</td>
		</tr>
		<tr>
			<td colspan="4">
				{{ challenge.description|forumfilter }}
			</td>
		</tr>
	{% endif %}
		<tr class="header">
			<td {% if not emails %}colspan="2"{% endif %}>
				{% trans "Name" %}{% sort "name" %}
			</td>
			{% if emails %}
				<td>
					{% trans "Email" %}
				</td>
			{% endif %}
			<td>
				{% trans "Time Received" %}{% sort "time" %}
			</td>
			<td>
				{% trans "Amount" %}{% sort "amount" %}
			</td>
		</tr>
	{% for bid in bids %}
		<tr>
			<td {% if not emails %}colspan="2"{% endif %}>
				<a href="{% url 'tracker.views.donor' id=bid.donation.donor.id %}">
					{% name bid.donation.donor.firstname bid.donation.donor.lastname usernames %}
				</a>
			</td>
			{% email bid.donation.donor.email emails "<td>.</td>" %}
			<td>
				{{ bid.donation.timereceived }}
			</td>
			<td>
				<a href="{% url 'tracker.views.donation' id=bid.donation.id %}">{{ bid.amount|money }}</a>
			</td>
		</tr>
		{% if comments %}
			{% if bid.donation.comment|length %}
			<tr>
				<td colspan="4">
					{% if bid.donation.commentstate == 'APPROVED' or fulllist %}
						{{ bid.donation.comment|forumfilter }}
					{% endif %}
					{% if bid.donation.commentstate == 'PENDING' %}
						({% trans "Comment not approved" %})
					{% elif bid.donation.commentstate == 'DENIED' %}
						({% trans "Comment rejected" %})
					{% endif %}
				</td>
			</tr>
			{% endif %}
		
			{% if forloop.counter < bids|length %}
			<tr class="header"><td colspan="4"></td></tr>
			{% endif %}
		{% endif %}
	{% endfor %}
	</table>
	<p><a href="{% url 'tracker.views.challenge' id=challenge.id %}{{ comments|yesno:',?comments' }}">
	{% include prepend|add:"tracker/commentslink.html" %}
	</a></p>
	<p><a href="{% url 'tracker.views.challengeindex' %}">{% trans "Back to Challenge Index" %}</a></p>
	{% include prepend|add:"tracker/navfooter.html" %}
{% endblock %}
